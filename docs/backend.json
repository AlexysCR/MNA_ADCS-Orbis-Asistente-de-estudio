{
  "entities": {
    "VoiceNote": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "VoiceNote",
      "type": "object",
      "description": "Represents a voice note recorded by the user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the voice note."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N VoiceNote)"
        },
        "recording": {
          "type": "string",
          "description": "The audio recording data (e.g., base64 encoded or a link to the recording)."
        },
        "transcription": {
          "type": "string",
          "description": "The transcribed text of the voice note."
        },
        "summary": {
          "type": "string",
          "description": "The AI-generated summary of the voice note."
        },
        "topic": {
          "type": "string",
          "description": "The topic or category of the voice note."
        },
        "dateCreated": {
          "type": "string",
          "description": "The date and time when the voice note was created.",
          "format": "date-time"
        },
        "dateModified": {
          "type": "string",
          "description": "The date and time when the voice note was last modified.",
          "format": "date-time"
        },
        "nextSteps": {
          "type": "array",
          "description": "A list of AI-generated next steps related to the voice note.",
          "items": {
            "type": "string"
          }
        },
        "references": {
          "type": "array",
          "description": "A list of AI-generated references related to the voice note.",
          "items": {
            "type": "string"
          }
        },
        "topicClusterId": {
          "type": "string",
          "description": "Reference to TopicCluster. (Relationship: TopicCluster 1:N VoiceNote)"
        }
      },
      "required": [
        "id",
        "userId",
        "recording",
        "dateCreated"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "The user's full name."
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "TopicCluster": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TopicCluster",
      "type": "object",
      "description": "Represents a cluster of voice notes related to the same topic.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the topic cluster."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N TopicCluster)"
        },
        "topic": {
          "type": "string",
          "description": "The main topic of the cluster."
        },
        "dateCreated": {
          "type": "string",
          "description": "The date and time when the topic cluster was created.",
          "format": "date-time"
        },
        "dateModified": {
          "type": "string",
          "description": "The date and time when the topic cluster was last modified.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "topic",
        "dateCreated"
      ]
    }
  },
  "auth": {
    "providers": [
      "password"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Collection to store user profiles.  Each document represents a user identified by their unique userId.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/voiceNotes/{voiceNoteId}",
        "definition": {
          "entityName": "VoiceNote",
          "schema": {
            "$ref": "#/backend/entities/VoiceNote"
          },
          "description": "Subcollection to store voice notes for a specific user. Each document represents a voice note owned by the user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "voiceNoteId",
              "description": "The unique identifier of the voice note."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/topicClusters/{topicClusterId}",
        "definition": {
          "entityName": "TopicCluster",
          "schema": {
            "$ref": "#/backend/entities/TopicCluster"
          },
          "description": "Subcollection to store topic clusters for a specific user. Each document represents a topic cluster owned by the user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "topicClusterId",
              "description": "The unique identifier of the topic cluster."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure secure and efficient storage of voice notes and related data, adhering to the principles of Authorization Independence, Structural Segregation, Access Modeling, and Data Clarity. User-owned data is stored under the `/users/{userId}` path, with subcollections for `voiceNotes` and `topicClusters`. This structure enables simple security rules based on path ownership.  Authorization Independence is achieved by avoiding `get()` calls within security rules. Since data is owned by individual users, no denormalization of ownership data is necessary, as path-based rules (`/users/{userId}/voiceNotes/{voiceNoteId}`) are sufficient to ensure that only the owning user can access the voice note. The design supports required QAPs (Queries Are Permissions) by leveraging the hierarchical structure. List operations are inherently secured by the path-based ownership model, where only the authenticated user can list voice notes within their designated path. Role-based access control is not required as the app is designed for single-user operation, thereby simplifying rules and enhancing security."
  }
}